{% extends 'base.html' %}
{% load user_tags %}
{% block title %} ¬∑ Profile{% endblock %}

{% block content %}
<div class="profile-page">
    <div class="profile-container">
        <!-- Left Column - Main Profile -->
        <div class="profile-main">
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-avatar-wrapper">
                    <div class="profile-avatar">
                        {% user_avatar profile.user size='large' %}
                    </div>
                    {% if profile.verification_status == 'verified' %}
                        <div class="verified-badge-overlay">
                            <svg fill="currentColor" viewBox="0 0 24 24">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                    {% endif %}
                </div>
                
                <div class="profile-info">
                    <div class="name-section">
                        <h1 class="profile-name">
                            {% if profile.user.first_name and profile.user.last_name %}
                                {{ profile.user.first_name }} {{ profile.user.last_name }}
                            {% else %}
                                {{ profile.user.username }}
                            {% endif %}
                        </h1>
                    </div>
                    
                    <div class="username-section">
                        <span class="username-text">@{{ profile.user.username }}</span>
                    </div>
                    
                    <div class="bio-section">
                        <p class="profile-bio">
                            {% if profile.bio %}
                                {{ profile.bio }}
                            {% else %}
                                Welcome to my profile! I'm passionate about sharing knowledge and learning new skills.
                            {% endif %}
                        </p>
                    </div>

                    <div class="profile-meta-badges">
                        <div class="meta-badge">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            Joined {{ profile.user.date_joined|date:"F Y" }}
                        </div>
                        <div class="meta-badge">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            {% if latest_submission and latest_submission.country %}
                                {{ latest_submission.country }}
                            {% elif profile.location %}
                                {{ profile.location }}
                            {% else %}
                                Not specified
                            {% endif %}
                        </div>
                    </div>

                    <div class="about-actions">
                        <a href="{% url 'users:profile_edit' %}" class="btn btn-primary">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Edit Profile
                        </a>
                        <a href="{% url 'users:verification_status' %}" class="btn btn-secondary">
                            {% if profile.verification_status == 'verified' %}
                                <svg fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Verified
                            {% elif profile.verification_status == 'pending' %}
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                Pending
                            {% else %}
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                </svg>
                                Get Verified
                            {% endif %}
                        </a>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="profile-nav">
                <button class="nav-tab active" data-tab="about">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    About Me
                </button>
                <button class="nav-tab" data-tab="learning">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    Learning Skills
                </button>
                <button class="nav-tab" data-tab="favorites">
                    <i class="bi bi-heart-fill"></i>
                    Favorites
                </button>
                <button class="nav-tab" data-tab="my-classes">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    My Classes
                </button>
                <button class="nav-tab" data-tab="enrolled-classes">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    Enrolled Classes
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- About Me Tab -->
                <div id="about-tab" class="tab-panel active">
                    <div class="about-section">
                        <h2 class="section-title">About Me</h2>
                        <div class="about-content">
                            <div class="about-details-grid">
                                <div class="detail-card">
                                    <div class="detail-icon">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Username</span>
                                        <span class="detail-value">{{ profile.user.username }}</span>
                                    </div>
                                </div>

                                <div class="detail-card">
                                    <div class="detail-icon">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Email</span>
                                        <span class="detail-value">{{ profile.user.email }}</span>
                                    </div>
                                </div>

                                {% if latest_submission and latest_submission.dob %}
                                <div class="detail-card">
                                    <div class="detail-icon">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Date of Birth</span>
                                        <span class="detail-value">{{ latest_submission.dob|date:"F j, Y" }}</span>
                                    </div>
                                </div>
                                {% endif %}

                                {% if latest_submission and latest_submission.nationality %}
                                <div class="detail-card">
                                    <div class="detail-icon">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"></path>
                                        </svg>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Nationality</span>
                                        <span class="detail-value">{{ latest_submission.nationality }}</span>
                                    </div>
                                </div>
                                {% endif %}

                                <div class="detail-card">
                                    <div class="detail-icon">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Location</span>
                                        <span class="detail-value">
                                            {% if latest_submission and latest_submission.country %}
                                                {{ latest_submission.country }}
                                            {% elif profile.location %}
                                                {{ profile.location }}
                                            {% else %}
                                                Not specified
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>

                                <div class="detail-card">
                                    <div class="detail-icon">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                        </svg>
                                    </div>
                                    <div class="detail-content">
                                        <span class="detail-label">Verification Status</span>
                                        <span class="detail-value">
                                            {% if profile.verification_status == 'verified' %}
                                                <span class="status-pill verified">Verified</span>
                                            {% elif profile.verification_status == 'pending' %}
                                                <span class="status-pill pending">Pending</span>
                                            {% else %}
                                                <span class="status-pill unverified">Unverified</span>
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Learning Skills Tab -->
                <div id="learning-tab" class="tab-panel">
                    <div class="skills-section">
                        <div class="section-header">
                            <h2 class="section-title">Learning Skills</h2>
                            <button class="btn btn-primary btn-icon" onclick="toggleAddSkillForm('learn')">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Add Skill
                            </button>
                        </div>
                        {% if learning_skills %}
                            <div class="skills-grid">
                                {% for user_skill in learning_skills %}
                                <div class="skill-card">
                                    <div class="skill-header">
                                        <div class="skill-icon-large">
                                            {% if 'guitar' in user_skill.skill.name|lower %}
                                                üé∏
                                            {% elif 'piano' in user_skill.skill.name|lower %}
                                                üéπ
                                            {% elif 'web' in user_skill.skill.name|lower or 'react' in user_skill.skill.name|lower or 'vue' in user_skill.skill.name|lower %}
                                                üíª
                                            {% elif 'design' in user_skill.skill.name|lower or 'ui' in user_skill.skill.name|lower %}
                                                üé®
                                            {% elif 'data' in user_skill.skill.name|lower or 'sql' in user_skill.skill.name|lower or 'python' in user_skill.skill.name|lower %}
                                                üìä
                                            {% else %}
                                                üîß
                                            {% endif %}
                                        </div>
                                        <a href="{% url 'users:delete_skill' user_skill.skill.id %}" class="delete-btn">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </a>
                                    </div>
                                    <div class="skill-body">
                                        <h3 class="skill-name">{{ user_skill.skill.name }}</h3>
                                        <span class="skill-level-badge level-{{ user_skill.level }}">{{ user_skill.level|title }}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                                <h3>No learning skills yet</h3>
                                <p>Start adding skills you want to learn and track your progress</p>
                                <button class="btn btn-primary" onclick="toggleAddSkillForm('learn')">Add Your First Skill</button>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Favorites Tab -->
                <div id="favorites-tab" class="tab-panel">
                    <div class="skills-section">
                        <div class="section-header">
                            <h2 class="section-title">Favorite Classes</h2>
                        </div>
                        {% if favorite_classes %}
                        <div class="classes-grid">
                            {% for cls in favorite_classes %}
                            <a href="{% url 'skills:class_detail' cls.slug %}" class="class-card">
                                <div class="class-content">
                                    <h3 class="class-title">{{ cls.title }}</h3>
                                    <p class="class-teacher">By {{ cls.teacher.username }}</p>
                                    <div class="class-meta">
                                        <span class="meta-item">{{ cls.get_difficulty_display }}</span>
                                        <span class="meta-dot">‚Ä¢</span>
                                        <span class="meta-item">{{ cls.duration_minutes }}m</span>
                                        {% if cls.avg_rating > 0 %}
                                            <span class="meta-dot">‚Ä¢</span>
                                            <span class="meta-item">‚≠ê {{ cls.avg_rating }} ({{ cls.reviews_count }})</span>
                                        {% endif %}
                                    </div>
                                    <div class="class-actions">
                                        <span class="btn btn-primary btn-small">View Class</span>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <i class="bi bi-heart" style="font-size: 48px; color: #d1d5db; margin-bottom: 16px;"></i>
                            <h3>No favorite classes yet</h3>
                            <p>Start exploring classes and favorite the ones you're interested in</p>
                            <a href="{% url 'skills:class_list' %}" class="btn btn-primary">Browse Classes</a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- My Classes Tab -->
                <div id="my-classes" class="tab-panel">
                    <div class="skills-section">
                        <div class="section-header">
                            <h2 class="section-title">My Classes</h2>
                        </div>
                        {% if my_classes_published or my_classes_drafts %}
                        <div class="classes-grid">
                            {% for cls in my_classes_published %}
                            <div class="class-card-new">
                                <div class="class-card-top">
                                    <div class="class-card-header">
                                        <h3 class="class-card-title">{{ cls.title }}</h3>
                                        <span class="class-card-status published-badge">Published</span>
                                    </div>
                                    <div class="class-card-info">
                                        <div class="class-info-item">
                                            <span class="class-info-label">Level</span>
                                            <span class="class-info-value">{{ cls.get_difficulty_display }}</span>
                                        </div>
                                        <div class="class-info-item">
                                            <span class="class-info-label">Duration</span>
                                            <span class="class-info-value">{{ cls.duration_minutes }}m</span>
                                        </div>
                                        <div class="class-info-item">
                                            <span class="class-info-label">Price</span>
                                            <span class="class-info-value price-highlight">{{ cls.price_display }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="class-card-footer">
                                    <a href="{% url 'skills:class_detail' cls.slug %}" class="class-card-btn primary-btn">View Class</a>
                                    <a href="{% url 'skills:manage_schedule' cls.slug %}" class="class-card-btn secondary-btn">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        Manage Schedule
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                            {% for cls in my_classes_drafts %}
                            <div class="class-card-new draft-card">
                                <div class="class-card-top">
                                    <div class="class-card-header">
                                        <h3 class="class-card-title">{{ cls.title }}</h3>
                                        <span class="class-card-status draft-badge">Draft</span>
                                    </div>
                                    <div class="class-card-info">
                                        <div class="class-info-item">
                                            <span class="class-info-label">Level</span>
                                            <span class="class-info-value">{{ cls.get_difficulty_display }}</span>
                                        </div>
                                        <div class="class-info-item">
                                            <span class="class-info-label">Duration</span>
                                            <span class="class-info-value">{{ cls.duration_minutes }}m</span>
                                        </div>
                                        <div class="class-info-item">
                                            <span class="class-info-label">Price</span>
                                            <span class="class-info-value price-highlight">{{ cls.price_display }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="class-card-footer">
                                    <a href="{% url 'skills:class_detail' cls.slug %}" class="class-card-btn primary-btn">View Class</a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            <h3>No classes yet</h3>
                            <p>Create your first class and start teaching on Ripple</p>
                            <a href="{% url 'skills:teacher_apply' %}" class="btn btn-primary">Create Your First Class</a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Enrolled Classes Tab -->
                <div id="enrolled-classes-tab" class="tab-panel">
                    <div class="skills-section">
                        <div class="section-header">
                            <h2 class="section-title">Enrolled Classes</h2>
                        </div>
                        {% if enrolled_classes %}
                        <div class="classes-grid">
                            {% for enrollment in enrolled_classes %}
                            <a href="{% url 'skills:class_detail' enrollment.teaching_class.slug %}" class="class-card enrolled-card">
                                <div class="class-status enrolled-status">
                                    <svg fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Enrolled
                                </div>
                                <div class="class-content">
                                    <h3 class="class-title">{{ enrollment.teaching_class.title }}</h3>
                                    <div class="class-meta">
                                        <span class="meta-item">By {{ enrollment.teaching_class.teacher.username }}</span>
                                        <span class="meta-dot">‚Ä¢</span>
                                        <span class="meta-item">{{ enrollment.teaching_class.get_difficulty_display }}</span>
                                        <span class="meta-dot">‚Ä¢</span>
                                        <span class="meta-item">{{ enrollment.teaching_class.duration_minutes }}m</span>
                                    </div>
                                    <div class="class-actions">
                                        <span class="btn btn-primary btn-small">View Class</span>
                                        <a href="{% url 'skills:view_schedule' enrollment.teaching_class.slug %}" class="btn btn-outline btn-small" onclick="event.stopPropagation();">Book Session</a>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                            </svg>
                            <h3>No enrolled classes yet</h3>
                            <p>Browse classes and enroll to start learning new skills</p>
                            <a href="{% url 'skills:class_list' %}" class="btn btn-primary">Browse Classes</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Add Skill Form Modal -->
            <div id="add-skill-form" class="modal" style="display: none;">
                <div class="modal-overlay" onclick="toggleAddSkillForm()"></div>
                <div class="modal-content">
                    <form method="post" action="{% url 'users:add_skill' %}">
                        {% csrf_token %}
                        <input type="hidden" name="skill_type" id="skill_type" value="learn">
                        <div class="modal-header">
                            <h3 id="form-title">Add New Learning Skill</h3>
                            <button type="button" class="close-btn" onclick="toggleAddSkillForm()">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="skill_name">Skill Name</label>
                                <input type="text" name="skill_name" id="skill_name" placeholder="e.g., Guitar, Piano, Python" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="level">Skill Level</label>
                                <select name="level" id="level">
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate" selected>Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                    <option value="expert">Expert</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="toggleAddSkillForm()">Cancel</button>
                            <button type="submit" class="btn btn-primary" id="submit-btn">Add Skill</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Column - Sidebar -->
        <div class="profile-sidebar">
            <!-- Communities Section -->
            <div class="sidebar-card">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">Communities</h3>
                    {% if profile.user.communities.all %}
                        <a href="{% url 'communities:communities' %}" class="view-all-link">View All</a>
                    {% endif %}
                </div>
                <div class="sidebar-content">
                    {% if profile.user.communities.all %}
                        <div class="communities-grid">
                            {% for community in profile.user.communities.all|slice:":6" %}
                            <a href="{% url 'communities:community_detail' community.pk %}" class="community-item">
                                <div class="community-avatar">
                                    {{ community.name|first|upper }}
                                </div>
                                <div class="community-info">
                                    <span class="community-name">{{ community.name|truncatewords:3 }}</span>
                                    <span class="community-members">{{ community.member_count }} members</span>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        {% if profile.user.communities.all.count > 6 %}
                            <div class="show-more">
                                <a href="{% url 'communities:communities' %}" class="show-more-link">
                                    +{{ profile.user.communities.all.count|add:"-6" }} more
                                </a>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="empty-sidebar">
                            <p>No communities joined yet.</p>
                            <a href="{% url 'communities:communities' %}" class="btn btn-outline btn-small">Browse Communities</a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Verification Prompt -->
            {% if profile.verification_status == 'unverified' %}
            <div class="sidebar-card verification-card">
                <div class="verification-icon">üîí</div>
                <div class="verification-content">
                    <h4>Get Verified</h4>
                    <p>Verify your identity to increase trust and unlock more features.</p>
                    <a href="{% url 'users:verify_identity' %}" class="btn btn-primary btn-small">Start Verification</a>
                </div>
            </div>
            {% else %}
            <!-- Teach on Ripple Card -->
            <div class="sidebar-card teach-card">
                <div class="teach-card-icon">üéì</div>
                <div class="teach-card-content">
                    <h4>Teach on Ripple</h4>
                    <p>Apply to become a teacher, upload an intro video and thumbnail, describe your expertise, and we'll review your application. Once approved, you can publish classes and reach learners.</p>
                    {% if my_pending_applications %}
                        <div class="teach-card-pending">
                            <span class="status-pill pending">Pending Applications: {{ my_pending_applications.count }}</span>
                        </div>
                    {% endif %}
                    <div class="teach-card-actions">
                        <a href="{% url 'skills:teacher_apply' %}" class="btn btn-primary btn-small">Apply to Teach</a>
                        <a href="{% url 'skills:class_list' %}" class="btn btn-outline btn-small">Browse Classes</a>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* Global Styles */
.profile-page {
    min-height: 100vh;
    background: #f9fafb;
    padding: 40px 24px;
}

.profile-container {
    max-width: 1400px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: 24px;
}

/* Main Profile Card */
.profile-main {
    background: white;
    border-radius: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    border: 1px solid #e5e7eb;
    overflow: hidden;
}

/* Profile Header */
.profile-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 48px 40px;
    display: flex;
    align-items: center;
    gap: 32px;
    position: relative;
}

.profile-avatar-wrapper {
    position: relative;
}

.profile-avatar {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    border: 5px solid white;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

.avatar-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-placeholder {
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 56px;
    font-weight: 800;
    color: white;
}

.verified-badge-overlay {
    position: absolute;
    bottom: 8px;
    right: 8px;
    width: 40px;
    height: 40px;
    background: #10b981;
    border-radius: 50%;
    border: 4px solid white;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.verified-badge-overlay svg {
    width: 24px;
    height: 24px;
}

.profile-info {
    flex: 1;
    color: white;
}

.profile-name {
    font-size: 36px;
    font-weight: 800;
    margin: 0 0 8px 0;
    color: white;
    letter-spacing: -0.5px;
}

.username-section {
    margin-bottom: 16px;
}

.username-text {
    font-size: 16px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 600;
}

.bio-section {
    margin-bottom: 20px;
}

.profile-bio {
    font-size: 16px;
    color: rgba(255, 255, 255, 0.95);
    line-height: 1.6;
    margin: 0;
}

.profile-meta-badges {
    display: flex;
    gap: 20px;
    margin-bottom: 24px;
}

.meta-badge {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
}

.meta-badge svg {
    width: 18px;
    height: 18px;
}

.about-actions {
    display: flex;
    gap: 12px;
}

/* Navigation Tabs */
.profile-nav {
    display: flex;
    padding: 0 40px;
    border-bottom: 2px solid #e5e7eb;
    background: white;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 transparent;
    -webkit-overflow-scrolling: touch;
}

.profile-nav::-webkit-scrollbar {
    height: 6px;
}

.profile-nav::-webkit-scrollbar-track {
    background: transparent;
}

.profile-nav::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
}

.profile-nav::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

.nav-tab {
    background: none;
    border: none;
    padding: 20px 24px;
    font-size: 15px;
    font-weight: 700;
    color: #6b7280;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    flex-shrink: 0;
}

.nav-tab svg {
    width: 20px;
    height: 20px;
}

.nav-tab:hover {
    color: var(--brand);
    background: rgba(102, 126, 234, 0.05);
}

.nav-tab.active {
    color: var(--brand);
    border-bottom-color: var(--brand);
    background: rgba(102, 126, 234, 0.05);
}

/* Tab Content */
.tab-content {
    padding: 40px;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}

/* Section Styles */
.section-title {
    font-size: 24px;
    font-weight: 800;
    color: var(--text);
    margin: 0 0 24px 0;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
}

/* About Section */
.about-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
}

.detail-card {
    display: flex;
    align-items: start;
    gap: 16px;
    padding: 20px;
    background: #f9fafb;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    transition: all 0.2s;
}

.detail-card:hover {
    background: #f3f4f6;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.detail-icon {
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--brand);
    flex-shrink: 0;
}

.detail-icon svg {
    width: 22px;
    height: 22px;
}

.detail-content {
    flex: 1;
    min-width: 0;
}

.detail-label {
    display: block;
    font-size: 13px;
    font-weight: 700;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
}

.detail-value {
    display: block;
    font-size: 16px;
    color: var(--text);
    font-weight: 600;
    word-break: break-word;
}

.status-pill {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.status-pill.verified {
    background: #d1fae5;
    color: #065f46;
}

.status-pill.pending {
    background: #fef3c7;
    color: #92400e;
}

.status-pill.unverified {
    background: #fee2e2;
    color: #991b1b;
}

/* Skills Grid */
.skills-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.skill-card {
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 16px;
    padding: 24px;
    transition: all 0.2s;
}

.skill-card:hover {
    border-color: var(--brand);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
}

.skill-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 16px;
}

.skill-icon-large {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
}

.delete-btn {
    width: 36px;
    height: 36px;
    background: #fee2e2;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ef4444;
    transition: all 0.2s;
    text-decoration: none;
}

.delete-btn:hover {
    background: #ef4444;
    color: white;
    transform: scale(1.1);
}

.delete-btn svg {
    width: 20px;
    height: 20px;
}

.skill-name {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    margin: 0 0 12px 0;
}

.skill-level-badge {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.skill-level-badge.level-beginner {
    background: #dbeafe;
    color: #1e40af;
}

.skill-level-badge.level-intermediate {
    background: #fef3c7;
    color: #92400e;
}

.skill-level-badge.level-advanced {
    background: #d1fae5;
    color: #065f46;
}

.skill-level-badge.level-expert {
    background: #ede9fe;
    color: #5b21b6;
}

/* Classes Grid - Redesigned */
.classes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 24px;
}

.class-card-new {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    min-height: 200px;
}

.class-card-new:hover {
    border-color: var(--brand);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    transform: translateY(-2px);
}

.class-card-top {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.class-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
    gap: 12px;
}

.class-card-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin: 0;
    line-height: 1.4;
    flex: 1;
}

.class-card-status {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 4px 10px;
    border-radius: 6px;
    white-space: nowrap;
    flex-shrink: 0;
}

.published-badge {
    background: #d1fae5;
    color: #065f46;
}

.draft-badge {
    background: #fef3c7;
    color: #92400e;
}

.class-card-info {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: auto;
}

.class-info-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.class-info-label {
    font-size: 11px;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.class-info-value {
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
}

.class-info-value.price-highlight {
    color: var(--brand);
    font-size: 15px;
}

.class-card-footer {
    padding: 16px 20px;
    background: #f9fafb;
    border-top: 1px solid #e5e7eb;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.class-card-btn {
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: all 0.2s;
    border: none;
    cursor: pointer;
    flex: 1;
    min-width: 120px;
}

.class-card-btn.primary-btn {
    background: var(--brand-gradient);
    color: white;
}

.class-card-btn.primary-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
}

.class-card-btn.secondary-btn {
    background: white;
    color: var(--brand);
    border: 1.5px solid var(--brand);
}

.class-card-btn.secondary-btn:hover {
    background: var(--brand);
    color: white;
}

.class-card-btn svg {
    width: 16px;
    height: 16px;
}

.draft-card .class-card-footer {
    justify-content: flex-start;
}

/* Ensure all cards have equal height using grid */
.classes-grid {
    align-items: stretch;
}

.classes-grid > .class-card-new {
    height: 100%;
}

/* Keep old styles for enrolled classes if needed */
.class-card {
    padding: 8px 16px;
    font-size: 13px;
    flex: 1;
    min-width: 120px;
    text-align: center;
    justify-content: center;
}

.class-actions .btn-small span {
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.class-actions .btn-small svg {
    width: 16px;
    height: 16px;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 64px 24px;
    background: #f9fafb;
    border-radius: 16px;
    border: 2px dashed #e5e7eb;
}

.empty-state svg {
    width: 64px;
    height: 64px;
    color: var(--muted);
    margin: 0 auto 20px;
}

.empty-state h3 {
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    margin: 0 0 8px 0;
}

.empty-state p {
    font-size: 15px;
    color: var(--muted);
    margin: 0 0 24px 0;
}

/* Modal */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
}

.modal-content {
    position: relative;
    background: white;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-header {
    padding: 24px 24px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    font-size: 24px;
    font-weight: 800;
    color: var(--text);
    margin: 0;
}

.close-btn {
    width: 36px;
    height: 36px;
    background: #f3f4f6;
    border: none;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.close-btn:hover {
    background: #e5e7eb;
}

.close-btn svg {
    width: 20px;
    height: 20px;
    color: #6b7280;
}

.modal-body {
    padding: 24px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 8px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid #e5e7eb;
    border-radius: 10px;
    font-size: 15px;
    color: var(--text);
    font-family: inherit;
    transition: all 0.2s;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--brand);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.modal-footer {
    padding: 0 24px 24px;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

/* Sidebar */
.profile-sidebar {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.sidebar-card {
    background: white;
    border-radius: 20px;
    padding: 24px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    border: 1px solid #e5e7eb;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.sidebar-title {
    font-size: 18px;
    font-weight: 800;
    color: var(--text);
    margin: 0;
}

.view-all-link {
    font-size: 14px;
    color: var(--brand);
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s;
}

.view-all-link:hover {
    color: #5a67d8;
}

.communities-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.community-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: #f9fafb;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    text-decoration: none;
    transition: all 0.2s;
}

.community-item:hover {
    background: #f3f4f6;
    transform: translateX(4px);
    border-color: var(--brand);
}

.community-avatar {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, var(--brand) 0%, #5a67d8 100%);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
    color: white;
    flex-shrink: 0;
}

.community-name {
    display: block;
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
}

.community-members {
    display: block;
    font-size: 12px;
    color: var(--muted);
}

.show-more {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #e5e7eb;
    text-align: center;
}

.show-more-link {
    font-size: 14px;
    color: var(--brand);
    text-decoration: none;
    font-weight: 600;
}

.show-more-link:hover {
    text-decoration: underline;
}

.empty-sidebar {
    text-align: center;
    padding: 20px;
}

.empty-sidebar p {
    font-size: 14px;
    color: var(--muted);
    margin: 0 0 16px 0;
}

.verification-card {
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border-color: #f59e0b;
}

.verification-icon {
    font-size: 48px;
    text-align: center;
    margin-bottom: 16px;
}

.verification-content h4 {
    font-size: 18px;
    font-weight: 800;
    color: #92400e;
    margin: 0 0 8px 0;
}

.verification-content p {
    font-size: 14px;
    color: #92400e;
    line-height: 1.5;
    margin: 0 0 20px 0;
}

.teach-card {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-color: var(--brand);
}

.teach-card-icon {
    font-size: 48px;
    text-align: center;
    margin-bottom: 16px;
}

.teach-card-content h4 {
    font-size: 18px;
    font-weight: 800;
    color: var(--text);
    margin: 0 0 8px 0;
}

.teach-card-content p {
    font-size: 14px;
    color: #6b7280;
    line-height: 1.5;
    margin: 0 0 20px 0;
}

.teach-card-pending {
    margin-bottom: 12px;
}

.teach-card-actions {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 24px;
    border: none;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 700;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn svg {
    width: 20px;
    height: 20px;
}

.btn-primary {
    background: linear-gradient(135deg, var(--brand) 0%, #5a67d8 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    color: white;
    text-decoration: none;
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.5);
    color: white;
    text-decoration: none;
}

/* NEW: Browse Classes Button Styling */
.btn-browse {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border: 2px solid transparent;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    font-weight: 700;
}

.btn-browse:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    color: white;
    text-decoration: none;
}

.btn-browse svg {
    width: 20px;
    height: 20px;
}

.btn-outline {
    background: transparent;
    color: var(--brand);
    border: 2px solid var(--brand);
}

.btn-outline:hover {
    background: var(--brand);
    color: white;
    text-decoration: none;
}

.btn-small {
    padding: 10px 18px;
    font-size: 14px;
}

.btn-icon {
    gap: 8px;
}

/* Responsive */
@media (max-width: 1024px) {
    .profile-container {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .profile-page {
        padding: 20px 12px;
    }
    
    .profile-header {
        flex-direction: column;
        text-align: center;
        padding: 32px 24px;
    }
    
    .profile-name {
        font-size: 28px;
    }
    
    .profile-meta-badges {
        justify-content: center;
    }
    
    .about-actions {
        flex-direction: column;
    }
    
    .tab-content {
        padding: 24px;
    }
    
    .profile-nav {
        overflow-x: auto;
        padding: 0 20px;
        scrollbar-width: thin;
    }
    
    .nav-tab {
        white-space: nowrap;
        padding: 16px 20px;
        font-size: 14px;
        flex-shrink: 0;
    }
    
    .about-details-grid,
    .skills-grid,
    .classes-grid {
        grid-template-columns: 1fr;
    }
    
}
</style>

<script>
function toggleAddSkillForm(skillType = 'learn') {
    const form = document.getElementById('add-skill-form');
    const skillTypeInput = document.getElementById('skill_type');
    const formTitle = document.getElementById('form-title');
    const submitBtn = document.getElementById('submit-btn');
    
    if (form.style.display === 'none') {
        skillTypeInput.value = skillType;
        formTitle.textContent = 'Add New Learning Skill';
        submitBtn.textContent = 'Add Skill';
        form.style.display = 'flex';
    } else {
        form.style.display = 'none';
    }
}

// Equalize class card heights
function equalizeCardHeights() {
    const grid = document.querySelector('.classes-grid');
    if (!grid) return;
    
    // Get all cards in the grid (new and old)
    const cards = grid.querySelectorAll('.class-card-new, .class-card');
    if (cards.length === 0) return;
    
    // Reset heights first
    cards.forEach(card => card.style.height = 'auto');
    
    // Group cards by row
    const rows = [];
    let currentRow = [];
    let currentTop = null;
    
    cards.forEach((card, index) => {
        const rect = card.getBoundingClientRect();
        if (currentTop === null || Math.abs(rect.top - currentTop) < 10) {
            currentRow.push(card);
            currentTop = rect.top;
        } else {
            rows.push(currentRow);
            currentRow = [card];
            currentTop = rect.top;
        }
    });
    if (currentRow.length > 0) {
        rows.push(currentRow);
    }
    
    // Set same height for all cards in each row
    rows.forEach(row => {
        let maxHeight = 0;
        row.forEach(card => {
            card.style.height = 'auto';
            maxHeight = Math.max(maxHeight, card.offsetHeight);
        });
        row.forEach(card => {
            card.style.height = maxHeight + 'px';
        });
    });
}

// Tab switching
document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.nav-tab');
    const panels = document.querySelectorAll('.tab-panel');
    
    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            
            tabs.forEach(t => t.classList.remove('active'));
            panels.forEach(p => p.classList.remove('active'));
            
            this.classList.add('active');
            const panel = document.getElementById(targetTab + '-tab') || document.getElementById(targetTab);
            if (panel) panel.classList.add('active');
            
            // Equalize card heights after tab switch
            setTimeout(equalizeCardHeights, 100);
        });
    });
    
    // Equalize card heights on page load
    equalizeCardHeights();
    
    // Also equalize on window resize
    let resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(equalizeCardHeights, 250);
    });
});
</script>
{% endblock %}