{% if has_avatar %}
    <div class="user-avatar-container" style="position: relative; width: 100%; height: 100%; border-radius: inherit; overflow: hidden; background: {{ avatar_color }};">
        <div class="user-avatar-initials {{ css_class }} avatar-placeholder-fallback" style="width: 100%; height: 100%; background: {{ avatar_color }}; border-radius: inherit; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: {% if size == 'small' %}0.75em{% elif size == 'large' %}1.5em{% else %}1em{% endif %}; position: absolute; top: 0; left: 0; z-index: 1; transition: opacity 0.15s ease-out;">
            {{ initials }}
        </div>
        <img src="{{ avatar_url }}" alt="{{ user.username }}" class="user-avatar-img {{ css_class }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: inherit; opacity: 0; transition: opacity 0.15s ease-in; position: absolute; top: 0; left: 0; z-index: 2; display: block;" loading="eager" onload="var img = this; img.style.opacity='1'; setTimeout(function(){ var placeholder = img.parentElement.querySelector('.avatar-placeholder-fallback'); if(placeholder) { placeholder.style.opacity='0'; setTimeout(function(){ if(placeholder) placeholder.style.display='none'; }, 150); } }, 100);" onerror="this.style.display='none';">
    </div>
{% else %}
    <div class="user-avatar-initials {{ css_class }}" style="width: 100%; height: 100%; background: {{ avatar_color }}; border-radius: inherit; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: {% if size == 'small' %}0.75em{% elif size == 'large' %}1.5em{% else %}1em{% endif %};">
        {{ initials }}
    </div>
{% endif %}
