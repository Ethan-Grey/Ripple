{% if has_avatar %}
    <div class="user-avatar-container" style="position: relative; width: 100%; height: 100%; border-radius: inherit; overflow: hidden;">
        <div class="user-avatar-initials {{ css_class }} avatar-placeholder-fallback" style="width: 100%; height: 100%; background: {{ avatar_color }}; border-radius: inherit; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: {% if size == 'small' %}0.75em{% elif size == 'large' %}1.5em{% else %}1em{% endif %}; position: absolute; top: 0; left: 0; z-index: 1;">
            {{ initials }}
        </div>
        <img src="{{ avatar_url }}" alt="{{ user.username }}" class="user-avatar-img {{ css_class }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: inherit; opacity: 0; transition: opacity 0.3s ease; position: relative; z-index: 2;" onload="this.style.opacity='1'; const placeholder = this.parentElement.querySelector('.avatar-placeholder-fallback'); if(placeholder) placeholder.style.display='none';" onerror="this.style.display='none';">
    </div>
{% else %}
    <div class="user-avatar-initials {{ css_class }}" style="width: 100%; height: 100%; background: {{ avatar_color }}; border-radius: inherit; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: {% if size == 'small' %}0.75em{% elif size == 'large' %}1.5em{% else %}1em{% endif %};">
        {{ initials }}
    </div>
{% endif %}
