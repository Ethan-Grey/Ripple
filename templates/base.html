{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ripple{% block title %}{% endblock %}</title>
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    
    <style>
        :root {
            --sidebar-width: 280px;
            --collision-breakpoint: 1200px;
        }
        
        .layout {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: var(--sidebar-width);
            transition: transform 0.3s ease-in-out;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            z-index: 1000;
        }
        
        /* Desktop - sidebar visible and pushes content */
        @media (min-width: 1201px) {
            .sidebar {
                position: sticky;
            }
            
            .content {
                margin-left: 0;
            }
        }
        
        /* Small window - sidebar hidden by default, overlays when open */
        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .content {
                margin-left: 0;
                width: 100%;
            }
            
            .toggle-sidebar-btn {
                left: 1rem !important;
            }
        }
        
        .content {
            flex: 1;
            min-width: 0;
            transition: margin-left 0.3s ease-in-out;
        }
        
        .toggle-sidebar-btn {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1002;
            background: #2b3a57;
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: left 0.3s ease-in-out;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .toggle-sidebar-btn:hover {
            background: #3d4f6d;
        }
        
        @media (min-width: 1201px) {
            .toggle-sidebar-btn.shifted {
                left: calc(var(--sidebar-width) - 2.5rem);
            }
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .overlay.active {
            display: block;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .nav-icon {
            min-width: 1.5rem;
            transition: margin 0.3s ease;
        }
        
        .nav-text {
            white-space: nowrap;
            transition: opacity 0.2s ease;
        }
        
        .admin-section-label {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: opacity 0.2s ease;
        }
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Sidebar toggle button -->
    <button class="toggle-sidebar-btn" id="sidebarToggle" aria-label="Toggle navigation">
        <i class="bi bi-list" style="font-size: 1.25rem;"></i>
    </button>
    
    <!-- Overlay for when sidebar is open on small screens -->
    <div class="overlay" id="overlay"></div>
    
    <div class="layout">
        <aside class="sidebar" id="sidebar">
            <div class="brand">Ripple</div>
            
            <nav class="nav" role="navigation">
                <a class="nav-item" href="{% url 'core:home' %}">
                    <i class="bi bi-house-door nav-icon"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a class="nav-item" href="{% url 'core:swipe' %}">
                    <i class="bi bi-arrow-left-right nav-icon"></i>
                    <span class="nav-text">Skill Swipe</span>
                </a>
                <a class="nav-item" href="{% url 'communities:communities' %}">
                    <i class="bi bi-people nav-icon"></i>
                    <span class="nav-text">Communities</span>
                </a>
                <a class="nav-item" href="{% url 'chat:messages' %}">
                    <i class="bi bi-chat-dots nav-icon"></i>
                    <span class="nav-text">Messages</span>
                </a>
                <a class="nav-item" href="{% url 'users:profile' %}">
                    <i class="bi bi-person nav-icon"></i>
                    <span class="nav-text">Profile</span>
                </a>
                
                {% if user.is_staff %}
                    <hr class="my-3 border-secondary">
                    <div class="admin-section-label">Admin Section</div>
                    <a class="nav-item" href="{% url 'skill_admin:skill_review' %}" style="background:#f59e0b;color:#92400e">
                        <i class="bi bi-clipboard-check nav-icon"></i>
                        <span class="nav-text">Admin Review</span>
                    </a>
                    <a class="nav-item" href="{% url 'users:admin_user_verifications' %}" style="background:#fde68a;color:#92400e">
                        <i class="bi bi-shield-check nav-icon"></i>
                        <span class="nav-text">User Verifications</span>
                    </a>
                    <a class="nav-item" href="{% url 'users:admin_user_skills' %}" style="background:#ef4444;color:#ffffff">
                        <i class="bi bi-gear nav-icon"></i>
                        <span class="nav-text">User Skills</span>
                    </a>
                    <a class="nav-item" href="{% url 'communities:admin_community_requests' %}" style="background:#a78bfa;color:#4c1d95">
                        <i class="bi bi-inbox nav-icon"></i>
                        <span class="nav-text">Community Requests</span>
                    </a>
                    <a class="nav-item" href="/admin/" style="background:#34d399;color:#065f46">
                        <i class="bi bi-speedometer2 nav-icon"></i>
                        <span class="nav-text">Django Admin</span>
                    </a>
                {% endif %}
                
                <div style="flex:1"></div>
                
                <a class="nav-item" href="{% url 'users:logout' %}" style="margin-top:auto;background:#2b3a57;color:#e6ecf5">
                    <i class="bi bi-box-arrow-right nav-icon"></i>
                    <span class="nav-text">Logout</span>
                </a>
            </nav>
        </aside>

        <main class="content">
            <header class="topbar">
                <form class="search" action="{% url 'core:search' %}" method="get" role="search">
                    <input type="text" name="q" placeholder="Search" value="{{ request.GET.q }}" aria-label="Search"/>
                </form>
                <div class="user-pill">
                    <i class="bi bi-person-circle me-1"></i>
                    {{ user.username|default:"User" }}
                </div>
            </header>

            <section class="page-body">
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
                
                {% block content %}{% endblock %}
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const toggleBtn = document.getElementById('sidebarToggle');
        const COLLISION_BREAKPOINT = 1200;
        
        const isSmallWindow = () => window.innerWidth <= COLLISION_BREAKPOINT;
        
        function updateSidebarState() {
            const small = isSmallWindow();
            
            if (small) {
                // Small window: sidebar closed by default, can be opened manually
                // Sidebar will overlay content when opened
                const isOpen = sidebar.classList.contains('open');
                if (isOpen) {
                    overlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                } else {
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
                toggleBtn.classList.remove('shifted');
            } else {
                // Large window: sidebar always visible, pushes content
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
                toggleBtn.classList.add('shifted');
            }
        }
        
        function toggleSidebar() {
            const small = isSmallWindow();
            
            if (small) {
                // Toggle open/closed state
                const isOpen = sidebar.classList.contains('open');
                if (isOpen) {
                    sidebar.classList.remove('open');
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    sidebar.classList.add('open');
                    overlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }
            // On large screens, toggle button doesn't do anything (sidebar always visible)
        }
        
        function closeSidebar() {
            if (isSmallWindow()) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        
        // Event listeners
        toggleBtn.addEventListener('click', toggleSidebar);
        overlay.addEventListener('click', closeSidebar);
        
        // Close sidebar when clicking nav links on small windows
        const navLinks = sidebar.querySelectorAll('.nav-item');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (isSmallWindow()) {
                    closeSidebar();
                }
            });
        });
        
        // Update on window resize - automatically close sidebar if window becomes small
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const wasSmall = sidebar.classList.contains('open');
                const isNowSmall = isSmallWindow();
                
                // Auto-close if transitioning from large to small
                if (!wasSmall && isNowSmall) {
                    sidebar.classList.remove('open');
                }
                
                updateSidebarState();
            }, 100);
        });
        
        // Highlight active nav item
        const currentPath = window.location.pathname;
        navLinks.forEach(link => {
            if (link.getAttribute('href') === currentPath) {
                link.classList.add('active');
            }
        });
        
        // Initialize state
        updateSidebarState();
    </script>
    <script src="{% static 'js/main.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>